---
interface Props {
  title: string;
  open?: boolean;
}

const { title, open = false } = Astro.props;
const id = title.toLowerCase().replace(/[^a-z0-9]+/g, '-');
const triggerId = `accordion-trigger-${id}`;
const panelId = `accordion-panel-${id}`;
---

<div class="accordion" data-accordion>
  <button
    class="accordion-trigger"
    type="button"
    id={triggerId}
    aria-expanded={open ? 'true' : 'false'}
    aria-controls={panelId}
  >
    <span>{title}</span>
    <span class="accordion-icon" aria-hidden="true">{open ? '\u00d7' : '+'}</span>
  </button>
  <div
    id={panelId}
    role="region"
    aria-labelledby={triggerId}
    class:list={['accordion-content', { 'is-open': open }]}
  >
    <div class="px-2 py-3">
      <slot />
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('[data-accordion]').forEach((accordion) => {
    const trigger = accordion.querySelector('.accordion-trigger') as HTMLButtonElement;
    const content = accordion.querySelector('.accordion-content') as HTMLElement;
    const icon = accordion.querySelector('.accordion-icon') as HTMLElement;

    trigger?.addEventListener('click', () => {
      const isOpen = content.classList.toggle('is-open');
      icon.textContent = isOpen ? '\u00d7' : '+';
      trigger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });
  });
</script>
