---
import type { PortfolioItem as PortfolioItemType } from '../lib/types';
import VideoPlayer from './VideoPlayer.astro';

interface Props {
  item: PortfolioItemType;
}

const { item } = Astro.props;

// Map display_size to column spans: mobile always 6, desktop varies
const lgSpanMap = { small: 8, medium: 12, large: 16 } as const;
const mdSpanMap = { small: 6, medium: 6, large: 12 } as const;
const lgSpan = lgSpanMap[item.display_size] ?? 8;
const mdSpan = mdSpanMap[item.display_size] ?? 6;
---

<div
  class="col-span-6 relative overflow-hidden"
  data-md-span={mdSpan}
  data-lg-span={lgSpan}
>
  {item.media_type === 'video' ? (
    <VideoPlayer src={item.media_url} poster={item.thumbnail_url ?? undefined} title={item.title} cover={false} />
  ) : (
    <img
      src={item.media_url}
      alt={item.title}
      class="w-full h-auto block"
    />
  )}

  {item.is_case_study && item.slug ? (
    <a
      href={`/work/${item.slug}`}
      class="absolute inset-0 flex items-end p-4 pb-12"
    >
      <span class="text-body text-caption-gray bg-white/90 px-2 py-1">
        View case study &rarr;
      </span>
    </a>
  ) : item.external_url && (
    <a
      href={item.external_url}
      target="_blank"
      rel="noopener noreferrer"
      class="absolute inset-0 flex items-end p-4 pb-12"
    >
      <span class="text-body text-caption-gray bg-white/90 px-2 py-1">
        View project &rarr;
      </span>
    </a>
  )}

  <div class="px-3 py-3">
    <p class="text-[10px] uppercase tracking-widest text-[#00FFFF]">{item.category}</p>
    <p class="text-sm font-medium text-white mt-1">{item.title}</p>
    {item.description && (
      <p class="text-xs text-neutral-400 mt-1 line-clamp-2">{item.description}</p>
    )}
  </div>
</div>

<style is:global>
  @media (min-width: 800px) {
    [data-md-span="6"] { grid-column: span 6; }
    [data-md-span="12"] { grid-column: span 12; }
  }
  @media (min-width: 1000px) {
    [data-lg-span="8"] { grid-column: span 8; }
    [data-lg-span="12"] { grid-column: span 12; }
    [data-lg-span="16"] { grid-column: span 16; }
  }
</style>
