---
import Admin from '../../layouts/Admin.astro';
import { getSupabaseAdmin } from '../../lib/env';

const supabaseAdmin = getSupabaseAdmin();

let activeProjectCount = 0;
let newInquiryCount = 0;
let pendingOrderCount = 0;

const [projectsRes, inquiriesRes, ordersRes] = await Promise.all([
  supabaseAdmin.from('projects').select('id', { count: 'exact', head: true }).in('status', ['discovery', 'proposal', 'active', 'review']),
  supabaseAdmin.from('project_inquiries').select('id', { count: 'exact', head: true }).eq('status', 'new'),
  supabaseAdmin.from('orders').select('id', { count: 'exact', head: true }).eq('status', 'paid'),
]);
activeProjectCount = projectsRes.count ?? 0;
newInquiryCount = inquiriesRes.count ?? 0;
pendingOrderCount = ordersRes.count ?? 0;
---

<Admin title="Dashboard">
  <h1 class="mb-6 text-lg font-semibold">Dashboard</h1>

  <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
    <a href="/admin/clients" class="border border-neutral-200 p-4 hover:bg-neutral-50">
      <p class="text-2xl font-semibold">{activeProjectCount}</p>
      <p class="text-sm text-neutral-500">Active projects</p>
    </a>
    <a href="/admin/inquiries" class="border border-neutral-200 p-4 hover:bg-neutral-50">
      <p class="text-2xl font-semibold">{newInquiryCount}</p>
      <p class="text-sm text-neutral-500">New inquiries</p>
    </a>
    <a href="/admin/orders" class="border border-neutral-200 p-4 hover:bg-neutral-50">
      <p class="text-2xl font-semibold">{pendingOrderCount}</p>
      <p class="text-sm text-neutral-500">Pending orders</p>
    </a>
  </div>
</Admin>
