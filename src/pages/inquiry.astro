---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import StickyBar from '../components/StickyBar.astro';
---

<BaseLayout title="Work with us — Tool">
  <Header />
  <main class="pb-12">
    <div class="site-grid py-6">
      <div class="col-span-6 md:col-span-6 lg:col-span-12">
        <p class="text-body font-medium mb-1">Tell us about your project</p>
        <p class="text-body text-caption-gray mb-6">We'll get back to you within 48 hours.</p>

        <form method="POST" action="/api/inquiry" id="inquiry-form" class="space-y-4">
          <div>
            <label for="name" class="block text-body font-medium mb-1">Name *</label>
            <input type="text" id="name" name="name" required
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors" />
          </div>

          <div>
            <label for="email" class="block text-body font-medium mb-1">Email *</label>
            <input type="email" id="email" name="email" required
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors" />
          </div>

          <div>
            <label for="company" class="block text-body font-medium mb-1">Company</label>
            <input type="text" id="company" name="company"
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors" />
          </div>

          <div>
            <label for="project_type" class="block text-body font-medium mb-1">What do you need?</label>
            <select id="project_type" name="project_type"
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors">
              <option value="">Select one...</option>
              <option value="branding">Branding</option>
              <option value="website">Website / Web App</option>
              <option value="design">Graphic Design</option>
              <option value="motion">Motion / Video</option>
              <option value="consulting">Technical Consulting</option>
              <option value="other">Something else</option>
            </select>
          </div>

          <div>
            <label for="description" class="block text-body font-medium mb-1">Tell us about it *</label>
            <textarea id="description" name="description" rows="5" required
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors resize-none"></textarea>
          </div>

          <div>
            <label for="budget_range" class="block text-body font-medium mb-1">Budget range</label>
            <select id="budget_range" name="budget_range"
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors">
              <option value="">Prefer not to say</option>
              <option value="< $5k">Less than $5k</option>
              <option value="$5k - $10k">$5k – $10k</option>
              <option value="$10k - $25k">$10k – $25k</option>
              <option value="$25k+">$25k+</option>
            </select>
          </div>

          <div>
            <label for="timeline" class="block text-body font-medium mb-1">Timeline</label>
            <select id="timeline" name="timeline"
              class="w-full py-2 text-body border-b border-neutral-300 bg-transparent focus:outline-none focus:border-neutral-900 transition-colors">
              <option value="">No rush</option>
              <option value="< 1 month">Less than 1 month</option>
              <option value="1-3 months">1–3 months</option>
              <option value="3-6 months">3–6 months</option>
              <option value="flexible">Flexible</option>
            </select>
          </div>

          <button type="submit" id="submit-btn"
            class="w-full py-3 bg-black text-white text-body font-medium hover:opacity-90 transition-opacity mt-2">
            Send
          </button>
        </form>
      </div>
    </div>
  </main>
  <Footer />
  <StickyBar />
</BaseLayout>

<script>
  const form = document.getElementById('inquiry-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    try {
      const formData = new FormData(form);
      const res = await fetch('/api/inquiry', {
        method: 'POST',
        body: formData,
      });

      if (res.ok) {
        window.location.href = '/inquiry/thanks';
      } else {
        const data = await res.json().catch(() => ({})) as { error?: string };
        alert(data.error || 'Something went wrong. Please try again.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send';
      }
    } catch {
      alert('Something went wrong. Please try again.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send';
    }
  });
</script>
