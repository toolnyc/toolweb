---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import StickyBar from '../components/StickyBar.astro';
import '../styles/global.css';
---

<BaseLayout title="Work with us — Tool">
  <Header />
  <main class="pb-14 pt-20">
    <div class="mx-auto max-w-xl px-6 py-12 md:py-24">
      <h1 class="text-3xl font-bold mb-2">Tell us about your project</h1>
      <p class="text-neutral-500 mb-10">We'll get back to you within 48 hours.</p>

      <form method="POST" action="/api/inquiry" id="inquiry-form" class="space-y-6">
        <!-- Name (required) -->
        <div>
          <label for="name" class="block text-sm font-semibold mb-2">Name *</label>
          <input type="text" id="name" name="name" required
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900" />
        </div>

        <!-- Email (required) -->
        <div>
          <label for="email" class="block text-sm font-semibold mb-2">Email *</label>
          <input type="email" id="email" name="email" required
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900" />
        </div>

        <!-- Company (optional) -->
        <div>
          <label for="company" class="block text-sm font-semibold mb-2">Company</label>
          <input type="text" id="company" name="company"
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900" />
        </div>

        <!-- Project Type (dropdown) -->
        <div>
          <label for="project_type" class="block text-sm font-semibold mb-2">What do you need?</label>
          <select id="project_type" name="project_type"
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900 bg-white">
            <option value="">Select one...</option>
            <option value="branding">Branding</option>
            <option value="website">Website / Web App</option>
            <option value="design">Graphic Design</option>
            <option value="motion">Motion / Video</option>
            <option value="consulting">Technical Consulting</option>
            <option value="other">Something else</option>
          </select>
        </div>

        <!-- Description (required) -->
        <div>
          <label for="description" class="block text-sm font-semibold mb-2">Tell us about it *</label>
          <textarea id="description" name="description" rows="5" required
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900"></textarea>
        </div>

        <!-- Budget Range (dropdown) -->
        <div>
          <label for="budget_range" class="block text-sm font-semibold mb-2">Budget range</label>
          <select id="budget_range" name="budget_range"
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900 bg-white">
            <option value="">Prefer not to say</option>
            <option value="< $5k">Less than $5k</option>
            <option value="$5k - $10k">$5k – $10k</option>
            <option value="$10k - $25k">$10k – $25k</option>
            <option value="$25k+">$25k+</option>
          </select>
        </div>

        <!-- Timeline (dropdown) -->
        <div>
          <label for="timeline" class="block text-sm font-semibold mb-2">Timeline</label>
          <select id="timeline" name="timeline"
            class="w-full px-4 py-3 border border-neutral-300 rounded focus:outline-none focus:ring-2 focus:ring-neutral-900 bg-white">
            <option value="">No rush</option>
            <option value="< 1 month">Less than 1 month</option>
            <option value="1-3 months">1–3 months</option>
            <option value="3-6 months">3–6 months</option>
            <option value="flexible">Flexible</option>
          </select>
        </div>

        <button type="submit" id="submit-btn"
          class="w-full py-3 bg-neutral-900 text-white rounded font-medium hover:opacity-90 transition-opacity">
          Send
        </button>
      </form>
    </div>
  </main>
  <Footer />
  <StickyBar />
</BaseLayout>

<script>
  const form = document.getElementById('inquiry-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    try {
      const formData = new FormData(form);
      const res = await fetch('/api/inquiry', {
        method: 'POST',
        body: formData,
      });

      if (res.ok) {
        window.location.href = '/inquiry/thanks';
      } else {
        const data = await res.json().catch(() => ({}));
        alert(data.error || 'Something went wrong. Please try again.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send';
      }
    } catch {
      alert('Something went wrong. Please try again.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send';
    }
  });
</script>
